<!--
    Psion OPK Editor v3.0 - Architecture Overview
    =============================================
    This is the main entry point (Bootstrapper) for the application.
    
    Architecture:
    - Single Page Application (SPA) structure.
    - Loads CSS styles for theming and layout.
    - Loads JavaScript modules in a specific order:
      1. Core/Logic: Data models and utilities (Constants, BinaryFile, PackImage).
      2. UI/Editors: Base classes and specific file editors.
      3. UI/Managers: Helpers for options, themes, tooltips.
      4. UI/Components: Reusable widgets (Modal, MemoryMap, PackContents).
      5. Controller: The main orchestrator (opkedit.js).
    
    The application initialization is triggered by the controller (opkedit.js)
    once the DOM is fully loaded.
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psion OPK Editor v3.0.1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        id="font-awesome-css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/editor.css">

    <link rel="stylesheet" href="styles/psion.css">
    <link rel="stylesheet" href="styles/syntax.css">
</head>

<body>
    <div id="app">
        <!-- Toolbar -->
        <div id="toolbar">
            <button class="tool-btn" id="btn-new-pack" title="New Pack">
                <i class="fas fa-file"></i> New
            </button>
            <button class="tool-btn" id="btn-open-pack" title="Open Pack">
                <i class="fas fa-folder-open"></i> Open
            </button>
            <button class="tool-btn" id="btn-save-pack" title="Save Pack">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="tool-btn" id="btn-export-hex" title="Export Intel HEX">
                <i class="fas fa-share-from-square"></i> Export Hex
            </button>

            <div class="tool-separator"></div>

            <button class="tool-btn" id="btn-add-item" title="Add New Item">
                <i class="fas fa-square-plus"></i> Add Item
            </button>
            <button class="tool-btn" id="btn-import-item" title="Import Item">
                <i class="fas fa-file-import"></i> Import Item
            </button>
            <button class="tool-btn" id="btn-delete-item" title="Delete Item">
                <i class="fas fa-trash-can"></i> Delete
            </button>

            <div class="tool-separator"></div>

            <button class="tool-btn" id="btn-apply" title="Apply Changes">
                <i class="fas fa-circle-check"></i> Apply
            </button>
            <button class="tool-btn" id="btn-discard" title="Discard Changes">
                <i class="fas fa-circle-arrow-left"></i> Discard
            </button>

            <div class="tool-separator"></div>

            <button class="tool-btn" id="btn-options" title="Options">
                <i class="fas fa-sliders"></i> Options
            </button>

            <div class="dropdown">
                <button class="tool-btn dropbtn" id="btn-help" title="Help">
                    <i class="fas fa-question-circle"></i> Help <i class="fas fa-angle-down"
                        style="font-size: 0.8em; margin-left: 3px;"></i>
                </button>
                <div class="dropdown-content" id="help-dropdown">
                    <a href="#" id="menu-opl-ref"><i class="fas fa-book" style="width: 20px;"></i> OPL Command
                        Reference</a>
                    <a href="key_template.html" target="_blank" id="menu-key-template"><i class="fas fa-keyboard"
                            style="width: 20px;"></i> Printable Key Template</a>
                    <a href="#" id="menu-about"><i class="fas fa-info-circle" style="width: 20px;"></i> About</a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Sidebar -->
            <div id="sidebar">
                <div id="sidebar-header">Pack Contents</div>
                <div id="pack-list">
                    <!-- Items will be populated here -->
                </div>
                <div id="sidebar-resizer"></div>
            </div>

            <!-- Editor Area -->
            <div id="editor-area">
                <div id="editor-header">
                    <span id="current-file-name">No file selected</span>
                </div>
                <div id="editor-container">
                    <!-- Code Editor will be mounted here -->
                    <div id="code-editor-container" style="width: 100%; height: 100%; display: none;"></div>
                    <!-- Legacy Editor for forms/headers -->
                    <div id="legacy-editor" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar">
            <div class="status-item" id="status-message">Ready</div>
            <div class="status-item" id="status-checksum"></div>
        </div>

        <!-- Hidden File Inputs -->
        <input type="file" id="file-input-pack" accept=".opk,.hex,.ihx,.bin">
        <input type="file" id="file-input-item" multiple>
    </div>

    <!-- Scripts -->
    <!-- Logic Scripts -->
    <script src="src/core/Constants.js"></script>
    <script src="src/logic/binaryfile.js"></script>
    <script src="src/logic/checksums.js"></script>
    <script src="src/logic/intelhex.js"></script>
    <script src="src/logic/packimage.js"></script>
    <script src="src/logic/decompiler/constants.js"></script>
    <script src="src/logic/decompiler/system_constants.js"></script>
    <script src="src/logic/decompiler/stack.js"></script>
    <script src="src/logic/decompiler/instruction_handler.js"></script>
    <script src="src/logic/decompiler/source_generator.js"></script>
    <script src="src/logic/decompiler/main.js"></script>
    <script src="src/ui/editors/BaseEditor.js"></script>
    <script src="src/ui/editors/HexEditor.js"></script>
    <script src="src/ui/editors/BlockFileEditor.js"></script>
    <script src="src/ui/editors/HeaderEditor.js"></script>
    <script src="src/ui/editors/HeaderlessFileEditor.js"></script>
    <script src="src/ui/editors/DataFileEditor.js"></script>
    <script src="src/ui/editors/ProcedureFileEditor.js"></script>
    <script src="src/ui/editors/NotePadFileEditor.js"></script>
    <script src="src/ui/editors/RecordEditor.js"></script>
    <script src="src/ui/editors/MemoryMapEditor.js"></script>
    <script src="src/ui/managers/optionsmanager.js"></script>
    <script src="src/ui/managers/thememanager.js"></script>
    <script src="src/ui/managers/tooltipmanager.js"></script>

    <!-- Controller -->
    <script src="src/ui/utils/EditorUtils.js"></script>
    <script src="src/ui/components/syntaxhighlighter.js"></script>
    <script src="src/ui/components/codeeditor.js"></script>
    <script src="src/ui/components/modal.js"></script>
    <script src="src/ui/components/dragdroplist.js"></script>
    <script src="src/ui/components/MemoryMap.js"></script>
    <script src="src/ui/components/HexViewer.js"></script>
    <script src="src/ui/components/CodeVisualizer.js"></script>
    <script src="src/ui/components/PackContents.js"></script>
    <script src="src/ui/components/OPLCommandData.js"></script>
    <script src="src/ui/components/OPLCommandReference.js"></script>
    <script src="src/ui/controllers/opkedit.js"></script>
    <script>
        // Initialize App
        // Controller will handle initialization
    </script>
</body>

</html>